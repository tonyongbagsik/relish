<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <style>
      body { font-family: Arial, sans-serif; padding: 20px; }
      label { display: block; margin-top: 10px; }
      input, select { padding: 5px; width: 200px; }
      button { margin-top: 15px; padding: 8px 15px; }
    </style>
  </head>
  <body>
    <h2>Staff Paylater Form</h2>
    <form id="paylaterForm">
      <label>Staff:
        <select id="staff" required></select>
      </label>
      <label>Date:
        <input type="date" id="date" required>
      </label>
      <label>Item:
        <select id="item" required></select>
      </label>
      <label>Quantity:
        <input type="number" id="quantity" min="0.01" step="0.01" required>
      </label>
      <label>Reason:
        <select id="reason" required>
          <option value="Pay Later">Pay Later</option>
          <option value="Cash">Cash</option>
        </select>
      </label>
      <button type="submit">Submit</button>
    </form>

    <p id="status"></p>

    <script>
      // --- Load staff and items from Sheets ---
      window.onload = function() {
        google.script.run.withSuccessHandler(populateStaff).getStaffList();
        google.script.run.withSuccessHandler(populateItems).getItemsList();
      }

      function populateStaff(data) {
        var staffSelect = document.getElementById("staff");
        data.forEach(function(s){ 
          var option = document.createElement("option");
          option.value = s; option.text = s;
          staffSelect.appendChild(option);
        });
      }

      function populateItems(data) {
        var itemSelect = document.getElementById("item");
        data.forEach(function(row){ 
          var option = document.createElement("option");
          option.value = row[0]; option.text = row[0] + " (" + row[1] + ")";
          itemSelect.appendChild(option);
        });
      }

      // --- Submit form ---
      document.getElementById("paylaterForm").addEventListener("submit", function(e){
        e.preventDefault();
        var payload = {
          staff: document.getElementById("staff").value,
          date: document.getElementById("date").value,
          item: document.getElementById("item").value,
          quantity: document.getElementById("quantity").value,
          reason: document.getElementById("reason").value
        };

        fetch("", {
          method: "POST",
          headers: { "Content-Type": "application/x-www-form-urlencoded" },
          body: new URLSearchParams(payload)
        })
        .then(res => res.text())
        .then(txt => document.getElementById("status").innerText = txt)
        .catch(err => document.getElementById("status").innerText = "Error: " + err);
      });
    </script>
  </body>
</html>
